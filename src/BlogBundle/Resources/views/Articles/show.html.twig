{% extends 'base.html.twig' %}
{% block title %}Blog - {{ article.title }}{% endblock %}
{% block stylesheets %}
    <link href="{{ asset('css/comments.css') }}" rel="stylesheet" type="text/css"/>
{% endblock %}
{% block body %}

    <script>
        function goBack() {
            window.history.back();
        }
    </script>

        <div class="container">
                <div class="row">
                    <span style="background-color:cornflowerblue; border-radius:0px;" class="label label-default" onclick="goBack()"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>RETOUR</span><br><br>
            {% for theme in article.themes %}
                <span class="label label-default">{{ theme }} </span> &nbsp;
            {% endfor %}
            <br>Créé par <b>{{ article.getAuthor }} </b> le {{ article.createdAt|date("d/m/Y") }}
            à {{ article.createdAt|date("H:i") }}
            {% if app.user and 'ROLE_READER' in app.user.roles %}
                <a href="{{ path('article_signaler', { 'id': article.id}) }}">signaler</a>
            {% endif %}
            <h1 class="col-xs-12">{{ article.title }}</h1>

            <div class="col-xs-12 col-md-8 col-md-offset-2">
                {{ article.content }}

            </div>
        </div>

        <div class="row">
            <h2 class="col-xs-12">Commentaires</h2>

            <div class="col-xs-12">
                {% include 'flashes/notice-flash.html.twig' %}
                {% include 'flashes/error-flash.html.twig' %}
            </div>

            {% if is_granted('ROLE_REVIEWER') %}
                <h3 class="col-xs-12">Poster un commentaire</h3>
                {{ form_start(form_comment, {'attr': {'class': 'col-xs-12'}}) }}


                <div class="form-group">
                    {{ form_label(form_comment.note, 'Note') }}
                    {% if form_errors(form_comment.note) %}
                        <div class="alert alert-danger">
                            <strong>Erreur !</strong> {{ form_errors(form_comment.note) }}
                        </div>
                    {% endif %}
                    {{ form_widget(form_comment.note, {'attr': {'class': 'form-control', 'min': 0, 'max': 10}}) }}
                </div>


                <div class="form-group">
                    {{ form_label(form_comment.content, 'Contenu du commentaire') }}
                    {% if form_errors(form_comment.content) %}
                        <div class="alert alert-danger">
                            <strong>Erreur !</strong> {{ form_errors(form_comment.content) }}
                        </div>
                    {% endif %}
                    {{ form_widget(form_comment.content, {'attr': {'class': 'form-control', 'required': 'required'}}) }}
                </div>

                {{ form_row(form_comment.submit, {'label': 'Soumettre', 'attr' : {'class' : 'btn btn-default'}}) }}
                {{ form_end(form_comment) }}
            {% endif %}

            <h3 class="col-xs-12">Précédentes réactions...</h3>

            <div class="comments col-xs-12">
                {% for comment in comments %}
                    <div class="comment-show panel panel-default" data-comment_id="{{ comment.id }}">
                        <div class="show-header panel-heading">
                            <p class="_wrapper">
                                <a href="{{ path('comment_delete', {'commentId': comment.id}) }}"
                                   style="margin-right: 20px;">
                                    <i class="fa fa-times"></i>
                                </a>
                                Commentaire de <strong>{{ comment.author }}</strong>.
                                <em>Note: {{ comment.note }} / 10</em>.
                                Posté le {{ comment.createdAt.format('Y-m-d H:i:s') }}
                                <span style="float:right;">
                                {% if app.user and 'ROLE_READER' in app.user.roles %}
                                    <a href="{{ path('comment_signaler', { 'id': comment.id}) }}">Signaler</a>
                                {% endif %}
                                </span>
                            </p>
                        </div>
                        <div class="show-body panel-body">
                            <p class="body-content">{{ comment.content }}</p>
                            {% if app.user == comment.author %}
                                <div class="body-options">
                                    <button class="options-modify btn btn-primary" data-comment_id="{{ comment.id }}">Modifier le commentaire</button>
                                </div>
                            {% endif %}

                        </div>
                    </div>

                    {{ form_start(forms_modify_comment[loop.index - 1], {'attr': {'class': 'comment-form hidden', 'data-comment_id': comment.id}}) }}
                        <div class="form-group">
                            {{ form_label(forms_modify_comment[loop.index - 1].note, 'Note') }}
                            {{ form_widget(forms_modify_comment[loop.index - 1].note, {'attr': {'class': 'form-control', 'min': 0, 'max': 10}}) }}
                        </div>

                        <div class="form-group">
                            {{ form_label(forms_modify_comment[loop.index - 1].content, 'Contenu du commentaire') }}
                            {{ form_widget(forms_modify_comment[loop.index - 1].content, {'attr': {'class': 'form-control', 'required': 'required'}}) }}
                        </div>

                        {{ form_row(forms_modify_comment[loop.index - 1].submit, {'label': 'Modifier le commentaire', 'attr' : {'class' : 'btn btn-default'}}) }}
                    {{ form_end(forms_modify_comment[loop.index - 1]) }}
                {% endfor %}

                {% if comments | length == 0 %}
                    <p>Pas de commentaires sous cet article !</p>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('javascript/comments.js') }}"></script>
{% endblock %}